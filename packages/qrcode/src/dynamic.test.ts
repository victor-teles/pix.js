import { PixQrCodeType } from '@pix.js/core'
import { describe, expect, test } from 'vitest'
import { createDynamic } from './dynamic'

describe('createDynamic', () => {
  test('should create a dynamic qrcode', async () => {
    const dynamic = createDynamic({
      merchantAccountInfo: {
        url: 'qrcode.pix.celcoin.com.br/pixqrcode/v2/46403cb5cf73b90a34b05467632f9a',
      },
      merchantName: 'Example',
      merchantCity: 'Example City',
      additionalData: { txId: '1234567890' },
    })

    const { payload, header } = await dynamic.getPayload()

    expect(payload).toBeDefined()
    expect(header).toBeDefined()
    expect(dynamic.brcode).toBe(
      '00020101021226910014br.gov.bcb.pix2569qrcode.pix.celcoin.com.br/pixqrcode/v2/46403cb5cf73b90a34b05467632f9a5204000053039865802BR5907Example6012Example City621405101234567890800400006304FCA1',
    )
    expect(dynamic.type).toBe(PixQrCodeType.Dynamic)
  })

  test('should create a qrcode data url', async () => {
    const dynamic = createDynamic({
      merchantAccountInfo: {
        url: 'qrcode.pix.celcoin.com.br/pixqrcode/v2/46403cb5cf73b90a34b05467632f9a',
      },
      merchantName: 'Example',
      merchantCity: 'Example City',
      additionalData: { txId: '1234567890' },
    })

    expect(await dynamic.toBase64()).toBe(
      'data:image/png;base64,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',
    )
  })
})
